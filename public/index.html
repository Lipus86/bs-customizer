<!DOCTYPE html>
<html lang="en">
<head>
    <title>Test</title>
    <link id="style" rel="stylesheet" type="text/css" href="all.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</head>


<body>
    <button class="btn btn-primary btn-lg allSettings" type="button" data-toggle="collapse" data-target="#allSettings" aria-expanded="false" aria-controls="collapseExample"><span class="glyphicon glyphicon-cog"></span></button>
    <div id="main" class="container">
        <form method="POST" id="generalForm">
            <div class="row">
                    <div class="collapse" id="allSettings">
                        <div class="well">
                            <div class="col-xs-4">
                                <label for="grayLase">$gray-base</label>
                                <input name="grayLase" id="grayLase" type="text" value="#000" class="form-control">
                            </div>
                            <div class="col-xs-4">
                                <label for="grayDarker">$gray-darker</label>
                                <input name="grayDarker" id="grayDarker" type="text" value="lighten($gray-base, 13.5%)" class="form-control">
                            </div>
                            <div class="col-xs-4">
                                <label for="grayDark">$gray-dark</label>
                                <input name="grayDark" id="grayDark" type="text" value="lighten($gray-base, 20%)" class="form-control">
                            </div>
                            <div class="clearfix"></div>
                            <div class="col-xs-4">
                                <label for="gray">$gray</label>
                                <input name="gray" id="gray" type="text" value="lighten($gray-base, 33.5%)" class="form-control">
                            </div>
                            <div class="col-xs-4">
                                <label for="grayLight">$gray-light</label>
                                <input name="grayLight" id="grayLight" type="text" value="lighten($gray-base, 46.7%)" class="form-control">
                            </div>
                            <div class="col-xs-4">
                                <label for="grayLighter">$gray-lighter</label>
                                <input name="grayLighter" id="grayLighter" type="text" value="lighten($gray-base, 93.5%)" class="form-control">
                            </div>
                            <div class="clearfix"></div>
                            <div class="col-xs-4">
                                <label for="brandPrimary">$brand-primary</label>
                                <input name="brandPrimary" id="brandPrimary" type="text" value="darken(#428bca, 6.5%)" class="form-control">
                            </div>
                            <div class="col-xs-4">
                                <label for="brandSuccess">$brand-success</label>
                                <input name="brandSuccess" id="brandSuccess" type="text" value="#5cb85c" class="form-control">
                            </div>
                            <div class="col-xs-4">
                                <label for="brandInfo">$brand-info</label>
                                <input name="brandInfo" id="brandInfo" type="text" value="#5bc0de" class="form-control">
                            </div>
                            <div class="clearfix"></div>
                            <div class="col-xs-4">
                                <label for="brandWarning">$brand-warning</label>
                                <input name="brandWarning" id="brandWarning" type="text" value="#f0ad4e" class="form-control">
                            </div>
                            <div class="col-xs-4">
                                <label for="brandDanger">$brand-danger</label>
                                <input name="brandDanger" id="brandDanger" type="text" value="#d9534f" class="form-control">
                            </div>
                            <div class="col-xs-12">
                                <input class="submitForm btn btn-success pull-right" type="submit" value="Update">
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
            <div id="info"></div>
            <div>
               <h1>Heading</h1>
               <h2>Subheading <a href="#">Subheading</a></h2>
               <h3>Subheading</h3>
               <h4>Subheading</h4>
               <h5>Subheading</h5>
               <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec venenatis pharetra nunc molestie ullamcorper. Morbi porttitor velit at sapien fringilla, ut ultricies enim blandit. Aliquam a viverra nulla. Duis vitae nulla eleifend, hendrerit diam eget, <a href="#">sollicitudin ligula</a>. Donec a sapien a elit faucibus hendrerit. Aenean dapibus lobortis est, non convallis dui dictum eu. Aliquam sit amet aliquet purus, nec sollicitudin lacus. Mauris id scelerisque neque, iaculis tempor justo. Maecenas fringilla lorem at nisl venenatis, et rutrum tortor viverra.</p>
               <blockquote>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec venenatis pharetra nunc molestie ullamcorper. Morbi porttitor velit at sapien fringilla, ut ultricies enim blandit. Aliquam a viverra nulla. Duis vitae nulla eleifend, <a href="#">hendrerit diam eget, sollicitudin ligula</a>. Donec a sapien a elit faucibus hendrerit. Aenean dapibus lobortis est, non convallis dui dictum eu. Aliquam sit amet aliquet purus, nec sollicitudin lacus. Mauris id scelerisque neque, iaculis tempor justo. Maecenas fringilla lorem at nisl venenatis, et rutrum tortor viverra.</blockquote>
            </div>
            <div class="well">
                <div class="btn-toolbar" role="toolbar">
                    <button type="button" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-star" aria-hidden="true"></span> Star</button>
                    <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-star" aria-hidden="true"></span> Star</button>
                    <button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-star" aria-hidden="true"></span> Star</button>
                    <button type="button" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-star" aria-hidden="true"></span> Star</button>
                </div>
            </div>
            <div class="well">
                <div class="btn-group">
                  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Default <span class="caret"></span></button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                  </ul>
                </div><!-- /btn-group -->
                <div class="btn-group">
                  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Primary <span class="caret"></span></button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                  </ul>
                </div><!-- /btn-group -->
                <div class="btn-group">
                  <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Success <span class="caret"></span></button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                  </ul>
                </div><!-- /btn-group -->
                <div class="btn-group">
                  <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Info <span class="caret"></span></button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                  </ul>
                </div><!-- /btn-group -->
                <div class="btn-group">
                  <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Warning <span class="caret"></span></button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                  </ul>
                </div><!-- /btn-group -->
                <div class="btn-group">
                  <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Danger <span class="caret"></span></button>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Separated link</a></li>
                  </ul>
                </div><!-- /btn-group -->
            </div>
        </form>
    </div>
   <script>
        $(function() {
            var prevElement,
                activeElements,
                elementsProp = {
                   'h1': ['hcolor', 'fx', 'gh', 'lf'],
                   'h2': ['gh', 'lf'],
                   'h3': [ 'gh', 'lf']
                };
            
            
            $('.submitForm').on('click', function(e){
                sendForm(e, $(this).parents('form').serialize());
                //console.log($(this).parents('form').serializeObject());
            });
            for (elem in elementsProp) {
                $(elem).data('properties', elementsProp[elem]);
                activeElements = activeElements + ',' + elem;
            };
            $(activeElements).on('click', function(e){
                var currentElement = $(this);
                showPopup(currentElement);
                e.stopPropagation();
                e.preventDefault();
            });
            $('body').on('click', function(e){
                hidePopup();
            });
            $(activeElements).on({
                mouseover : function(e) {
                    $(activeElements).removeClass('hover');
                   $(this).addClass('hover');
                    e.stopPropagation();
                },
                mouseleave: function(e) {
                    $(this).removeClass('hover');
                    e.stopPropagation();
                }
            });
            $(document).on('keyup', function(e) {
              if (e.keyCode == 27) hidePopup();
            });
            
            function sendForm(e, formData){
                $.ajax({
                  type: 'POST',
                  url: '/',
                  data: formData,
                  success: function(data) {
                    $('#style').attr('href', 'all.css');
                    (data == 'OK') ? hideError() : showError('Check values');
                  },
                  error:  function(){
                        showError('Problem with network');
                    }
                });
                e.preventDefault();
            };
            function showError(text){
                $('#info').html('<div class="alert alert-danger" role="alert">' + text + '</div>');
            };
            function hideError(){
                $('#info').html('&nbsp;');
            };
            function showPopup(currentElement){
                if (prevElement)  hidePopup(prevElement);
                generatePopup(currentElement);
                currentElement.addClass('active-element');
                prevElement = currentElement;
            };
            function hidePopup(){
                $('#pop-up').remove();
                prevElement.removeClass('active-element');
            };
            function generatePopup(currentElement){
                var properties = currentElement.data('properties');
                $('body').append('<div id="pop-up" class="well"></div>')
                for (prop in properties) {
                    $('#pop-up').append('<input type="text" name="' + properties[prop] + '"/>');
                }
                $('#pop-up').append('<input class="btn btn-info submitForm" type="submit" value="Update" /><a href="#" class="close"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>');
                $('.close, .allSettings').on('click', function(){
                    hidePopup();
                });
            };
            $.fn.serializeObject = function(){
                var o = {};
                var a = this.serializeArray();
                $.each(a, function() {
                    if (o[this.name] !== undefined) {
                        if (!o[this.name].push) {
                            o[this.name] = [o[this.name]];
                        }
                        o[this.name].push(this.value || '');
                    } else {
                        o[this.name] = this.value || '';
                    }
                });
                return o;
            };
       });
    </script>
    <style>
        body {
            padding-bottom: 50px;
        }
        #main {
            position: relative;
        }
        #pop-up {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            z-index: 100;
            margin-bottom: 0;
            border-radius: 4px 4px 0 0;
            border-bottom: none;
        }
        .hover {
            outline: 2px solid #66f !important;
        }
        .active-element, .active-element:focus {
            outline: 9999px solid rgba(0,0,0,0.3) !important;
            position: relative;
            z-index: 10;
        }
        .allSettings {
            position: absolute;
            z-index: 100;
            right: 0;
            outline: none !important;
            border-color: #fff;
            border-radius: 0 0 0 4px;
            border-top: none;
        }
        #allSettings .well {
            border-radius: 0 0 5px 5px;
            border-top: none;
        }
        #allSettings input {
            margin-bottom: 10px;
        }
    </style>
</body>
</html>